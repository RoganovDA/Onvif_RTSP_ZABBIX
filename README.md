# ONVIF/RTSP Camera Audit Script

–°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞—É–¥–∏—Ç–∞ IP-–∫–∞–º–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π ONVIF –∏ RTSP.
–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ **Zabbix** —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîç –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö ONVIF-–ø–æ—Ä—Ç–æ–≤ –∏ —Ä–∞–±–æ—á–∏—Ö —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–µ—Ä–µ–±–æ—Ä –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π).
- üìú –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–º–µ—Ä–µ:
  - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å (Manufacturer)
  - –ú–æ–¥–µ–ª—å (Model)
  - –í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ (FirmwareVersion)
  - –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä (SerialNumber)
  - –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–π ID (HardwareId)
- üåê –°–±–æ—Ä —Å–µ—Ç–µ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫:
  - MAC-–∞–¥—Ä–µ—Å
  - IP-–∞–¥—Ä–µ—Å
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ NTP –∏ DNS
- ‚è± –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ —Å –∫–∞–º–µ—Ä–æ–π (–¥–æ–ø—É—Å—Ç–∏–º–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è).
- üë• –ê—É–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–∞–º–µ—Ä—ã:
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –ª–∏–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
  - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —É—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.
- üé• –ü—Ä–æ–≤–µ—Ä–∫–∞ RTSP-–ø–æ—Ç–æ–∫–∞:
  - –ó–∞—Ö–≤–∞—Ç –∫–∞–¥—Ä–æ–≤ —Å –∞–Ω–∞–ª–∏–∑–æ–º (—Ä–∞–∑–º–µ—Ä –∫–∞–¥—Ä–∞, —è—Ä–∫–æ—Å—Ç—å, –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏, FPS).
  - –§–æ–ª–±—ç–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ç–æ–∫–∞ —á–µ—Ä–µ–∑ `ffprobe`, –µ—Å–ª–∏ OpenCV –Ω–µ —Å–ø—Ä–∞–≤–∏–ª—Å—è.
  - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º ¬´—Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–≥–æ¬ª, ¬´–∂—ë–ª—Ç–æ–≥–æ¬ª –∏ ¬´–∑–µ–ª—ë–Ω–æ–≥–æ¬ª —Å–¥–≤–∏–≥–∞ –º–∞—Ç—Ä–∏—Ü—ã.
- üîê –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ONVIF-–º–µ—Ç–æ–¥–æ–≤: —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ, –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –∏ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤—ã–∑–æ–≤—ã.

---
## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚ö° **–ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**  
  –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é –ø–æ–¥–±–∏—Ä–∞—Ç—å ONVIF-–ø–æ—Ä—Ç—ã, —Å—Å—ã–ª–∫–∏ RTSP –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –∫–∞–º–µ—Ä.

- üîó **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**  
  –°–∫—Ä–∏–ø—Ç —Å–∞–º –Ω–∞—Ö–æ–¥–∏—Ç —Ä–∞–±–æ—á–∏–π ONVIF-–ø–æ—Ä—Ç –∏ RTSP-–ø–æ—Ç–æ–∫ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å –º–∞–∫—Ä–æ—Å—ã –∏–ª–∏ –≤—Ä—É—á–Ω—É—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —É–∑–ª—ã –≤ Zabbix.

- üõ†Ô∏è **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Zabbix**  
  –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞–º–µ—Ä—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–ª—å–∫–æ IP-–∞–¥—Ä–µ—Å–∞. –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å –º–∞–∫—Ä–æ—Å—ã –≤—Ä–æ–¥–µ `{$PORT}`, `{$USERNAME}`, `{$PASSWORD}`. (–Ω–µ –∑–∞–±—É–¥—å—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å/–¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ `param.py` ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã `DEFAULT_USERNAME`, `DEFAULT_PASSWORD`, `PASSWORDS`)

- üöÄ **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**  
  –†–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –∫–∞–º–µ—Ä, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç ONVIF, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –∏–ª–∏ –º–æ–¥–µ–ª–∏.

- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞—É–¥–∏—Ç**  
  –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∫–∞–º–µ—Ä–µ.

---
## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –Ω–∞ "—á–∏—Å—Ç—ã–π" —Å–µ—Ä–≤–µ—Ä Zabbix (Ubuntu/Debian) –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
–∫–æ—Ç–æ—Ä—ã–π —Ä–∞–Ω–µ–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª —Å Python-—Å–∫—Ä–∏–ø—Ç–∞–º–∏.

### 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python

```bash
python3 --version
```

* –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –Ω–∏–∂–µ 3.11, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Python (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –ø–∞–∫–µ—Ç–∞
  `python3.11` –∏–ª–∏ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞).

### 2. –°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥

–í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–ª–∂–Ω—ã –ª–µ–∂–∞—Ç—å –≤–º–µ—Å—Ç–µ, —á—Ç–æ–±—ã –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª–µ–π —Ä–∞–±–æ—Ç–∞–ª–∏
–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –í –∫–∞—Ç–∞–ª–æ–≥–µ `externalscripts` Zabbix –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è **–≤—Å–µ** `.py`
—Ñ–∞–π–ª—ã –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: `camcheck.py`, `baseline.py`, `param.py`,
`onvif_utils.py`, `rtsp_utils.py`, `cli.py` –∏ –¥—Ä—É–≥–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏.

```bash
sudo mkdir -p /usr/lib/zabbix/externalscripts/onvif_audit
sudo chown -R zabbix:zabbix /usr/lib/zabbix/externalscripts
```

### 3. –°–∫–∞—á–∏–≤–∞–µ–º –ø—Ä–æ–µ–∫—Ç

```bash
cd /tmp
wget https://github.com/RoganovDA/Onvif_RTSP_ZABBIX/archive/refs/heads/main.zip -O Onvif_RTSP_ZABBIX.zip
unzip Onvif_RTSP_ZABBIX.zip
cd Onvif_RTSP_ZABBIX-main
```

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞ —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞, —á—Ç–æ–±—ã –Ω–µ
–æ—Å—Ç–∞–≤–∞–ª–∏—Å—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –º–æ–¥—É–ª–∏ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ: –∫–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã
–∫–∞–º—á–µ–∫–∞, –∞ –Ω–µ –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã):

```bash
sudo rm -f /usr/lib/zabbix/externalscripts/{camcheck.py,baseline.py,param.py,onvif_utils.py,rtsp_utils.py,cli.py}
```

–ó–∞—Ç–µ–º –∫–æ–ø–∏—Ä—É–µ–º –≤—Å–µ `.py` —Ñ–∞–π–ª—ã –∏ —Ñ–∞–π–ª—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:

```bash
sudo cp *.py /usr/lib/zabbix/externalscripts/
sudo chown zabbix:zabbix /usr/lib/zabbix/externalscripts/*.py
sudo chmod 750 /usr/lib/zabbix/externalscripts/*.py
```

> **–í–∞–∂–Ω–æ:** –Ω–µ –∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—ã–±–æ—Ä–æ—á–Ω–æ —Ñ–∞–π–ª—ã ‚Äî –±–µ–∑ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
> `onvif_utils.py` –∏–ª–∏ `rtsp_utils.py` —Å–∫—Ä–∏–ø—Ç —É–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π –∏–º–ø–æ—Ä—Ç–∞.

### 4. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

```bash
python3 -m venv /usr/lib/zabbix/externalscripts/venv
source /usr/lib/zabbix/externalscripts/venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
deactivate
```

–ß—Ç–æ–±—ã Zabbix –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –¥–æ–±–∞–≤—å—Ç–µ –≤ `/etc/zabbix/zabbix_server.conf`:

```
ExternalScripts=/usr/lib/zabbix/externalscripts
```

–ò –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–ª—É–∂–±—É:

```bash
sudo systemctl restart zabbix-server
```

–ï—Å–ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ:

```bash
sudo -H python3 -m pip install --upgrade pip
sudo -H python3 -m pip install -r requirements.txt
```

### 5. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

`ffmpeg`/`ffprobe` –Ω—É–∂–Ω—ã –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ RTSP –ø–æ—Ç–æ–∫–∞.

```bash
sudo apt update
sudo apt install ffmpeg
```

### 6. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `zabbix` –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø—É—Å–∫ `.py` —Ñ–∞–π–ª–æ–≤ –∏ –∑–∞–ø–∏—Å—å
–≤ –∫–∞—Ç–∞–ª–æ–≥ `onvif_audit` (–¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞—É–¥–∏—Ç–∞).

```bash
sudo chown -R zabbix:zabbix /usr/lib/zabbix/externalscripts
sudo chmod 750 /usr/lib/zabbix/externalscripts/*.py
sudo chmod 770 /usr/lib/zabbix/externalscripts/onvif_audit
```

### 7. –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `param.py`, —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –ª–æ–≥–∏–Ω–æ–≤ –∏
–ø–∞—Ä–æ–ª–µ–π, —Ç–∞–π–º–∞—É—Ç—ã –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–±–æ—Ä–∞.

```bash
sudo nano /usr/lib/zabbix/externalscripts/param.py
```

–ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Zabbix –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

### 8. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é

–ü–µ—Ä–µ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Zabbix –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏:

```bash
sudo -u zabbix python3 /usr/lib/zabbix/externalscripts/camcheck.py 192.0.2.10 --debug
```

–ó–∞–º–µ–Ω–∏—Ç–µ `192.0.2.10` –Ω–∞ IP-–∞–¥—Ä–µ—Å —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞–º–µ—Ä—ã. –ï—Å–ª–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è JSON —Å
–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π, –∑–Ω–∞—á–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ:

1. –í—Å–µ `.py` —Ñ–∞–π–ª—ã –ª–µ–∂–∞—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `externalscripts`.
2. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt`.
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `zabbix` –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç/–∫ –∫–∞–º–µ—Ä–µ.

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
./camcheck.py <IP-–∞–¥—Ä–µ—Å –∫–∞–º–µ—Ä—ã> [--logfile /path/to/log] [--debug] [--username USERNAME] [--password PASSWORD] [--ping-timeout SECONDS]
```

–û–ø—Ü–∏–∏:
- `--logfile` ‚Äî –ø—É—Ç—å –¥–ª—è –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏);
- `--debug` ‚Äî –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ;
- `--username` ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–∞–º–µ—Ä—ã;
- `--password` ‚Äî –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
- `--ping-timeout` ‚Äî —Ç–∞–π–º–∞—É—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, —Å–µ–∫.
- `--full-output` ‚Äî –≤–µ—Ä–Ω—É—Ç—å –ø–æ–ª–Ω—ã–π —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π JSON (–∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö).



–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä–∏–ø—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–ª–æ—Å–∫–∏–π JSON-–æ—Ç—á—ë—Ç, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –≤–µ—Ä—Å–∏—è–º–∏:

```json
{
    "Manufacturer": "ActiveCam",
    "Model": "AC-D8111IR2",
    "FirmwareVersion": "IPCAM_V2.46.170906",
    "SerialNumber": "D8111IR2M07Z031870873",
    "HardwareId": "600110002-BV-H1002",
    "HwAddress": "f0:23:b9:45:33:69",
    "Address": "10.0.6.101",
    "DNSname": null,
    "TimeSyncOK": true,
    "TimeDifferenceSeconds": 0,
    "ONVIFStatus": "success",
    "NewUsersDetected": false,
    "NewUsernames": [],
    "RemovedUsernames": [],
    "BaselineCreated": false,
    "UserCount": 1,
    "RTSPPort": 101,
    "RTSPPath": "/live/main",
    "RTSPTransport": "tcp",
    "RTSPBestURI": "rtsp://user:***@10.0.6.101/live/main",
    "status": "ok",
    "frames_read": 53,
    "avg_frame_size_kb": 3600.0,
    "width": 1280,
    "height": 960,
    "avg_brightness": 131.98,
    "frame_change_level": 0.1,
    "real_fps": 17.67,
    "note": "",
    "ColorDiagnosis": "balanced",
    "ColorConfidence": 0.94,
    "ColorStability": "stable",
    "ColorDominantChannel": "green",
    "ColorTriggeredMetrics": null,
    "ColorMaxVariance": 6.1,
    "ColorMaxRatio": 1.08,
    "ColorFrameCount": 53,
    "ColorReason": "No significant colour cast detected",
    "ColorRatios": {
        "blue_green": 0.92,
        "red_green": 1.04,
        "red_blue": 1.13,
        "green_blue": 1.09,
        "green_red": 0.96,
        "max_min": 1.13
    },
    "ColorBalance": {
        "blue": 0.33,
        "green": 0.34,
        "red": 0.33
    },
    "ColorChannels": {
        "blue": 108.2,
        "green": 111.4,
        "red": 119.0
    },
    "Notes": [],
    "NextAttemptAfter": null
}
```

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç—á—ë—Ç —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ —Ñ–∞–∑–∞–º–∏ (`phase.*`), –ø–æ—Ç–æ–∫–æ–≤—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –∏ —Å–ø–∏—Å–∫–æ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥ `--full-output`.

**–ü–æ—è—Å–Ω–µ–Ω–∏—è –∫ –ø–æ–ª—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

- `ONVIFStatus` ‚Äî –∏—Ç–æ–≥ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (`success`, `unauthorized`, `locked`, `not_supported`).
- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º –º–µ—Ç–æ–¥–∞–º (–∫–∞–∫–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∞–Ω–æ–Ω–∏–º–Ω–æ, —Ç—Ä–µ–±—É—é—Ç –ª–æ–≥–∏–Ω–∞ –∏–ª–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–µ –∞—É–¥–∏—Ç–∞ `onvif_audit/<IP>_users.json`.

**–ü–æ–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**

- `ColorDiagnosis` ‚Äî –∏—Ç–æ–≥–æ–≤—ã–π –¥–∏–∞–≥–Ω–æ–∑ —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ (`balanced`, `purple`, `yellow`, `green`, `unknown`).
- `ColorConfidence` ‚Äî —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ (0‚Äì1); —á–µ–º –±–ª–∏–∂–µ –∫ 1, —Ç–µ–º –Ω–∞–¥—ë–∂–Ω–µ–µ –≤—ã–≤–æ–¥.
- `ColorStability` –∏ `ColorMaxVariance` ‚Äî –æ—Ü–µ–Ω–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å—Ü–µ–Ω—ã –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏ (–ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å –≤—Å–ø—ã—à–∫–∏ –æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å–¥–≤–∏–≥–∞).
- `ColorRatios`, `ColorBalance`, `ColorChannels` ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∫–∞–Ω–∞–ª–∞–º B/G/R.
- `ColorTriggeredMetrics` ‚Äî –∫–∞–∫–∏–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ø–æ—Ä–æ–≥ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø–µ—Ä–µ–∫–æ—Å–∞.

---

## –ë–∞–∑–æ–≤–∞—è –ª–∏–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–°–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–∞—Ä–æ–ª—å –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –∫–∞—Ç–∞–ª–æ–≥
`onvif_audit`. –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞–º–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã `<IP>_users.json` –∏
`<IP>_progress.json`, –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—á—ë—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏ –Ω–µ
–ø–æ–≤—Ç–æ—Ä—è—Ç—å —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏. –í `<IP>_users.json` –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è
—Å–ø–∏—Å–∫–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö, –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –∏ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –º–µ—Ç–æ–¥–æ–≤ (`open_methods`,
`protected_methods`, `unsupported_methods`), –∞ —Ç–∞–∫–∂–µ –ø–æ–¥—Ä–æ–±–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
(`method_status`) –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞—É–¥–∏—Ç–∞.

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Zabbix

- –¢–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–∞–Ω–Ω—ã—Ö: `External Check`
- –ö–ª—é—á –≤—ã–∑–æ–≤–∞:  
  ```bash
  camcheck.py["{HOST.IP}"]
  ```
- –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: **–¢–µ–∫—Å—Ç**
- –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–µ:
  - **JSONPath** –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `$.status`, `$.TimeSyncOK`).

–ù–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–µ–π –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã:
- "–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ ONVIF"
- "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è RTSP-–ø–æ—Ç–æ–∫–∞"
- "–û–±–Ω–∞—Ä—É–∂–µ–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –∫–∞–º–µ—Ä–µ"
- "–°–∏–ª—å–Ω–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏"
- "–°–º–µ—â–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π/–∂—ë–ª—Ç—ã–π/–∑–µ–ª—ë–Ω—ã–π)"

---

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|:--------|:---------|:---------------------|
| `DEFAULT_USERNAME` | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | `admin` |
| `DEFAULT_PASSWORD` | –ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ | `000000` |
| `PASSWORDS` | –°–ø–∏—Å–æ–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ | `["admin", "12345678", "000000"]` |
| `ALLOWED_TIME_DIFF_SECONDS` | –î–æ–ø—É—Å—Ç–∏–º–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ UTC, —Å–µ–∫ | `120` |
| `PORTS_TO_CHECK` | –°–ø–∏—Å–æ–∫ –ø–æ—Ä—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ ONVIF | `[80, 8000, 8080, 8899, 10554, 10080, 554, 37777, 5000, 443]` |
| `MAX_PASSWORD_ATTEMPTS` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥–±–æ—Ä–∞ –ø–∞—Ä–æ–ª—è | `5` |
| `MAX_MAIN_ATTEMPTS` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | `3` |
| `RTSP_PATH_CANDIDATES` | –°–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤—ã—Ö RTSP-–ø—É—Ç–µ–π –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç ONVIF | `["/Streaming/Channels/101", "/h264", "/live", "/stream1"]` |
| `DEFAULT_RTSP_PORT` | RTSP-–ø–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | `554` |
| `CV2_OPEN_TIMEOUT_MS` | –¢–∞–π–º–∞—É—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è RTSP –≤ OpenCV, –º—Å | `5000` |
| `CV2_READ_TIMEOUT_MS` | –¢–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è –∫–∞–¥—Ä–∞ –≤ OpenCV, –º—Å | `5000` |
| `COLOR_CAST_RULES` | –ü–æ—Ä–æ–≥–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–µ–∫–æ—Å–∞ | —Å–º. `param.py` |
| `COLOR_CONFIDENCE_SCALE` | –ú–∞—Å—à—Ç–∞–± –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–∏–∞–≥–Ω–æ–∑–∞ | `0.35` |
| `COLOR_VARIANCE_STABLE_THRESHOLD` | –ì—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å—Ü–µ–Ω—ã | `25.0` |
| `ONVIF_PRIORITY_METHODS` | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Å–µ—Ä–≤–∏—Å, –º–µ—Ç–æ–¥, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã) | —Å–º. `param.py` |

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!**

- Python 3.11+
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Python (—Å–º. `requirements.txt`):
  - `onvif` (–ø–∞–∫–µ—Ç `onvif-zeep`)
  - `opencv-python`
  - `numpy`
  - `zeep`
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã `ffmpeg` –∏ `ffprobe`
---

## TODO

- ‚úÖ –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ONVIF –∏ RTSP –∫–∞–º–µ—Ä.
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏ –∞—É–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Zabbix —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- [ ] –®–∞–±–ª–æ–Ω –¥–ª—è Zabbix 7.0, 7.2
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Digest (–¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–æ–¥–µ–ª–µ–π –∫–∞–º–µ—Ä).
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–º–µ—Ä –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —á–µ—Ä–µ–∑ Zabbix LLD.
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ RTSP –ø–æ—Ç–æ–∫–∞: –±–∏—Ç—Ä–µ–π—Ç, –∫–æ–¥–µ–∫, –∞—É–¥–∏–æ-–ø–æ—Ç–æ–∫–∏.
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ HTTPS –¥–ª—è ONVIF.
- [ ] –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª.


---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License ‚Äî —Å–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∞–≤—Ç–æ—Ä—Å—Ç–≤–∞.

---

## –ê–≤—Ç–æ—Ä—ã

- [RoganovDA](https://github.com/RoganovDA)

---


