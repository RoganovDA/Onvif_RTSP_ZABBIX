# ONVIF/RTSP Camera Audit Script

–°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞—É–¥–∏—Ç–∞ IP-–∫–∞–º–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π ONVIF –∏ RTSP.  
–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ **Zabbix** —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîç –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö ONVIF-–ø–æ—Ä—Ç–æ–≤ –∏ —Ä–∞–±–æ—á–∏—Ö —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–µ—Ä–µ–±–æ—Ä –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π).
- üìú –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–º–µ—Ä–µ:
  - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å (Manufacturer)
  - –ú–æ–¥–µ–ª—å (Model)
  - –í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ (FirmwareVersion)
  - –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä (SerialNumber)
  - –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–π ID (HardwareId)
- üåê –°–±–æ—Ä —Å–µ—Ç–µ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫:
  - MAC-–∞–¥—Ä–µ—Å
  - IP-–∞–¥—Ä–µ—Å
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ NTP –∏ DNS
- ‚è± –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ —Å –∫–∞–º–µ—Ä–æ–π (–¥–æ–ø—É—Å—Ç–∏–º–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è).
- üë• –ê—É–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–∞–º–µ—Ä—ã:
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –ª–∏–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
  - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —É—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.
- üé• –ü—Ä–æ–≤–µ—Ä–∫–∞ RTSP-–ø–æ—Ç–æ–∫–∞:
  - –ó–∞—Ö–≤–∞—Ç –∫–∞–¥—Ä–æ–≤ —Å –∞–Ω–∞–ª–∏–∑–æ–º (—Ä–∞–∑–º–µ—Ä –∫–∞–¥—Ä–∞, —è—Ä–∫–æ—Å—Ç—å, –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏, FPS).
  - –§–æ–ª–±—ç–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ç–æ–∫–∞ —á–µ—Ä–µ–∑ `ffprobe`, –µ—Å–ª–∏ OpenCV –Ω–µ —Å–ø—Ä–∞–≤–∏–ª—Å—è.

---
## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚ö° **–ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**  
  –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é –ø–æ–¥–±–∏—Ä–∞—Ç—å ONVIF-–ø–æ—Ä—Ç—ã, —Å—Å—ã–ª–∫–∏ RTSP –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –∫–∞–º–µ—Ä.

- üîó **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**  
  –°–∫—Ä–∏–ø—Ç —Å–∞–º –Ω–∞—Ö–æ–¥–∏—Ç —Ä–∞–±–æ—á–∏–π ONVIF-–ø–æ—Ä—Ç –∏ RTSP-–ø–æ—Ç–æ–∫ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å –º–∞–∫—Ä–æ—Å—ã –∏–ª–∏ –≤—Ä—É—á–Ω—É—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —É–∑–ª—ã –≤ Zabbix.

- üõ†Ô∏è **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Zabbix**  
  –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞–º–µ—Ä—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–ª—å–∫–æ IP-–∞–¥—Ä–µ—Å–∞. –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å –º–∞–∫—Ä–æ—Å—ã –≤—Ä–æ–¥–µ `{$PORT}`, `{$USERNAME}`, `{$PASSWORD}`. (–Ω–µ –∑–∞–±—É–¥—å—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å/–¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ camcheck.py)

- üöÄ **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**  
  –†–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –∫–∞–º–µ—Ä, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç ONVIF, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –∏–ª–∏ –º–æ–¥–µ–ª–∏.

- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞—É–¥–∏—Ç**  
  –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∫–∞–º–µ—Ä–µ.

---
## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
    ```bash
    pip install onvif-zeep opencv-python numpy
    ```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ffmpeg (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ç–æ–∫–∞ —á–µ—Ä–µ–∑ ffprobe):
    ```bash
    sudo apt install ffmpeg
    ```

3. –ü–æ–º–µ—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `externalscripts` Zabbix —Å–µ—Ä–≤–µ—Ä–∞:
    ```bash
    wget https://github.com/RoganovDA/Onvif_RTSP_ZABBIX/archive/refs/heads/main.zip -O Onvif_RTSP_ZABBIX.zip && unzip Onvif_RTSP_ZABBIX.zip && cd Onvif_RTSP_ZABBIX-main
    cp camcheck.py /usr/lib/zabbix/externalscripts/
    chmod +x /usr/lib/zabbix/externalscripts/camcheck.py
    mkdir /usr/lib/zabbix/externalscripts/onvif_audit
    sudo chown zabbix:zabbix /usr/lib/zabbix/externalscripts/onvif_audit
    sudo chown zabbix:zabbix /usr/lib/zabbix/externalscripts/camcheck.py
    ```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
./camcheck.py <IP-–∞–¥—Ä–µ—Å –∫–∞–º–µ—Ä—ã> [--logfile /path/to/log]
```

–û–ø—Ü–∏—è `--logfile` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª. (–¢–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏) 



–ù–∞ –≤—ã—Ö–æ–¥–µ —Å–∫—Ä–∏–ø—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```json
{
    "Manufacturer": "ActiveCam",
    "Model": "AC-D8111IR2",
    "FirmwareVersion": "IPCAM_V2.46.170906",
    "SerialNumber": "D8111IR2M07Z031870873",
    "HardwareId": "600110002-BV-H1002",
    "HwAddress": "f0:23:b9:45:33:69",
    "Address": "10.0.6.101",
    "DNSname": null,
    "TimeSyncOK": true,
    "TimeDifferenceSeconds": 0,
    "NewUsersDetected": false,
    "NewUsernames": [],
    "BaselineCreated": false,
    "UserCount": 1,
    "RTSPPort": 101,
    "RTSPPath": "/live/main",
    "status": "ok",
    "frames_read": 53,
    "avg_frame_size_kb": 3600.0,
    "width": 1280,
    "height": 960,
    "avg_brightness": 131.98,
    "frame_change_level": 0.1,
    "real_fps": 17.67,
    "note": ""
}
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Zabbix

- –¢–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–∞–Ω–Ω—ã—Ö: `External Check`
- –ö–ª—é—á –≤—ã–∑–æ–≤–∞:  
  ```bash
  camcheck.py["{HOST.IP}"]
  ```
- –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: **–¢–µ–∫—Å—Ç**
- –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–µ:
  - **JSONPath** –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `$.status`, `$.TimeSyncOK`).

–ù–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–µ–π –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã:
- "–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ ONVIF"
- "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è RTSP-–ø–æ—Ç–æ–∫–∞"
- "–û–±–Ω–∞—Ä—É–∂–µ–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –∫–∞–º–µ—Ä–µ"
- "–°–∏–ª—å–Ω–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏"

---

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|:--------|:---------|:---------------------|
| `ALLOWED_TIME_DIFF_SECONDS` | –î–æ–ø—É—Å—Ç–∏–º–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ UTC, —Å–µ–∫ | `120` |
| `PORTS_TO_CHECK` | –°–ø–∏—Å–æ–∫ –ø–æ—Ä—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ ONVIF | `[80, 8000, 8080, 8899, 10554, 10080, 554, 37777, 5000, 443]` |
| `PASSWORDS` | –°–ø–∏—Å–æ–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ | `["admin", "12345678", "PASS3"]` |

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!**

- Python 3.11+
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Python:
  - `onvif` (–ø–∞–∫–µ—Ç `onvif-zeep`)
  - `opencv-python`
  - `numpy`
  - `zeep`
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã `ffmpeg` –∏ `ffprobe`
---

## TODO

- ‚úÖ –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ONVIF –∏ RTSP –∫–∞–º–µ—Ä.
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏ –∞—É–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Zabbix —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- [ ] –®–∞–±–ª–æ–Ω –¥–ª—è Zabbix 7.0, 7.2
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Digest (–¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–æ–¥–µ–ª–µ–π –∫–∞–º–µ—Ä).
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–º–µ—Ä –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —á–µ—Ä–µ–∑ Zabbix LLD.
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ RTSP –ø–æ—Ç–æ–∫–∞: –±–∏—Ç—Ä–µ–π—Ç, –∫–æ–¥–µ–∫, –∞—É–¥–∏–æ-–ø–æ—Ç–æ–∫–∏.
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ HTTPS –¥–ª—è ONVIF.
- [ ] –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª.


---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License ‚Äî —Å–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∞–≤—Ç–æ—Ä—Å—Ç–≤–∞.

---

## –ê–≤—Ç–æ—Ä—ã

- [RoganovDA](https://github.com/RoganovDA)

---


